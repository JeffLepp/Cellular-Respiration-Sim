<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Matrix Chart</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
<svg></svg>
<script>
    const svgWidth = 500, svgHeight = 300, barPadding = 5, borderSpacer = 12;
    let svg = d3.select("svg")
        .attr("width", svgWidth)
        .attr("height", svgHeight)
        .style("background-color", "black");
    
    let ws = new WebSocket("ws://localhost:6789");

    svg.append("text")
    .attr("x", svgWidth / 2)
    .attr("y", 20)
    .attr("text-anchor", "middle")
    .attr("fill", "white")
    .attr("font-size", "18px")
    .text("Cytoplasm State");

    
    ws.onmessage = function(event) {
        let rawData = JSON.parse(event.data);
        let entries = Object.entries(rawData); // â†’ [["ADP", 30], ["ATP", 45], ...]
    
        let barWidth = svgWidth / entries.length;
    
        svg.selectAll("*").remove(); // Clear old
    
        // Bars
        svg.selectAll("rect")
            .data(entries)
            .enter()
            .append("rect")
            .attr("x", (d, i) => barWidth * i + borderSpacer / 2)
            .attr("y", d => svgHeight - d[1])
            .attr("width", barWidth - barPadding)
            .attr("height", d => d[1])
            .attr("fill", "white");
    
        // Values
        svg.selectAll("text.value")
            .data(entries)
            .enter()
            .append("text")
            .attr("class", "value")
            .text(d => d[1])
            .attr("x", (d, i) => barWidth * i + borderSpacer / 2 + (barWidth - barPadding) / 2)
            .attr("y", d => svgHeight - d[1] - 5)
            .attr("text-anchor", "middle")
            .attr("fill", "white")
            .attr("font-size", "12px");
    
        // Labels
        svg.selectAll("text.label")
            .data(entries)
            .enter()
            .append("text")
            .attr("class", "label")
            .text(d => d[0])
            .attr("x", (d, i) => barWidth * i + borderSpacer / 2 + (barWidth - barPadding) / 2)
            .attr("y", svgHeight - 5)
            .attr("text-anchor", "middle")
            .attr("fill", "white")
            .attr("font-size", "10px");
    };
    </script>
    