<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <title>Matrix Chart</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>

    <style>
        #container {
          display: flex;
        }
      
        svg {
          background-color: black;
          margin: 10px;
        }
      </style>

</head>
<body>

    <svg id="cytoplasm-chart"></svg>
    <svg id="matrix-chart"></svg>
  
    <script>
        const svgWidth = 500, svgHeight = 300, barPadding = 5, borderSpacer = 6;
        
        let cytoplasmSVG = d3.select("#cytoplasm-chart")
            .attr("width", svgWidth)
            .attr("height", svgHeight);
        
        let matrixSVG = d3.select("#matrix-chart")
            .attr("width", svgWidth)
            .attr("height", svgHeight);
        
        // Add static chart titles
        cytoplasmSVG.append("text")
            .attr("x", svgWidth / 2)
            .attr("y", 25)
            .attr("text-anchor", "middle")
            .attr("fill", "white")
            .attr("font-size", "18px")
            .text("Cytoplasm");
        
        matrixSVG.append("text")
            .attr("x", svgWidth / 2)
            .attr("y", 25)
            .attr("text-anchor", "middle")
            .attr("fill", "white")
            .attr("font-size", "18px")
            .text("Matrix");
        
        let ws = new WebSocket("ws://localhost:6789");
        
        ws.onmessage = function(event) {
            const allData = JSON.parse(event.data);
            const cytoplasmData = Object.entries(allData.cytoplasm);
            const matrixData = Object.entries(allData.matrix);
        
            drawChart(cytoplasmSVG, cytoplasmData);
            drawChart(matrixSVG, matrixData);
        };
        
        function drawChart(svg, entries) {
            const barWidth = svgWidth / entries.length;
        
            let bars = svg.selectAll("rect.bar").data(entries);
            bars.enter()
                .append("rect")
                .attr("class", "bar")
                .merge(bars)
                .attr("x", (d, i) => barWidth * i + borderSpacer / 2)
                .attr("y", d => svgHeight - d[1])
                .attr("width", barWidth - barPadding)
                .attr("height", d => d[1])
                .attr("fill", "white");
            bars.exit().remove();
        
            let names = svg.selectAll("text.name").data(entries);
            names.enter()
                .append("text")
                .attr("class", "name")
                .merge(names)
                .text(d => d[0])
                .attr("x", (d, i) => barWidth * i + borderSpacer / 2 + (barWidth - barPadding) / 2)
                .attr("y", d => svgHeight - d[1] - 18)
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .attr("font-size", "11px");
            names.exit().remove();
        
            let values = svg.selectAll("text.value").data(entries);
            values.enter()
                .append("text")
                .attr("class", "value")
                .merge(values)
                .text(d => d[1])
                .attr("x", (d, i) => barWidth * i + borderSpacer / 2 + (barWidth - barPadding) / 2)
                .attr("y", d => svgHeight - d[1] - 5)
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .attr("font-size", "11px");
            values.exit().remove();
        }

        </script>
</body>
</html>